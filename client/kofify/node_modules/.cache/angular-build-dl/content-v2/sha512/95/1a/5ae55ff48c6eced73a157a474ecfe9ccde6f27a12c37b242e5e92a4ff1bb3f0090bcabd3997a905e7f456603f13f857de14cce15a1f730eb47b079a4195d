{"version":3,"sources":["./src/app/_pages/messages/messages.page.html","./src/app/_pages/messages/messages.module.ts","./src/app/_pages/messages/messages.page.scss","./src/app/_pages/messages/messages.page.ts"],"names":[],"mappings":"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","file":"_pages-messages-messages-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>messages</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-padding\\\">\\n    <div *ngIf=\\\"chats && chats.length == 0\\\">\\n        <ion-label padding>{{'no_messages' | translate }}</ion-label>\\n    </div>\\n    <ion-list *ngIf=\\\"!chats\\\">\\n        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>\\n        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>\\n      </ion-list>\\n        <ion-item *ngFor=\\\"let chat of chats\\\" (click)=\\\"goToChat(chat, $event)\\\">\\n            <img \\n            class=\\\"user-img\\\"\\n            (load)=\\\"loadImg($event)\\\"\\n            (click)=\\\"$event.stopPropagation(); viewProfile(chat.users[0].user.id)\\\"\\n            onError=\\\"this.src='../../assets/imgs/user.svg';\\\"             \\n            src=\\\"{{chat.img}}\\\" />\\n          <ion-label class=\\\"chat-name\\\">\\n            <h3>{{chat.name}}</h3>\\n            <p *ngIf=\\\"chat.lastMessage\\\" [class.notReadMessage]=\\\"chat.lastMessage.readBy.indexOf(user?.id) == -1\\\">{{chat.lastMessage.content}}</p>\\n          </ion-label>\\n          <div class=\\\"not-read-checker\\\" *ngIf=\\\"chat.lastMessage.readBy.indexOf(user?.id) == -1\\\"></div>\\n        </ion-item>\\n\\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MessagesPage } from './messages.page';\nimport { TranslateModule } from '@ngx-translate/core';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MessagesPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    TranslateModule.forChild(),\n    RouterModule.forChild(routes)\n  ],\n  declarations: [MessagesPage]\n})\nexport class MessagesPageModule {}\n","export default \".notReadMessage {\\n  font-weight: bold;\\n  color: #999; }\\n\\n.user-message-img {\\n  background: #fff;\\n  display: block;\\n  -webkit-transition: opacity linear 0.3s;\\n  transition: opacity linear 0.3s;\\n  height: 45px;\\n  width: 45px;\\n  border-radius: 100%;\\n  background-size: 100%; }\\n\\n.not-read-checker {\\n  background: red;\\n  position: absolute;\\n  top: 15px;\\n  right: 10px;\\n  width: 5px;\\n  height: 5px;\\n  border-radius: 100%;\\n  padding: 0; }\\n\\n.chat-name > h3 {\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  margin-right: 50px;\\n  overflow: hidden; }\\n\\n.user-img {\\n  width: 40px;\\n  height: 40px;\\n  margin-right: 8px;\\n  border-radius: 100%; }\\n\\n.user-message-img-hide {\\n  opacity: 0.3; }\\n\\n.user-message-img-show {\\n  opacity: 1; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGV4ZXkvQXBwUHJvamVjdHMvaWNlYnJlYWtlci9jbGllbnQva29maWZ5L3NyYy9hcHAvX3BhZ2VzL21lc3NhZ2VzL21lc3NhZ2VzLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGlCQUFpQjtFQUNqQixXQUFXLEVBQUE7O0FBSWY7RUFDSSxnQkFBaUI7RUFDakIsY0FBYztFQUNkLHVDQUErQjtFQUEvQiwrQkFBK0I7RUFDL0IsWUFBWTtFQUNaLFdBQVc7RUFDWCxtQkFBbUI7RUFDbkIscUJBQXFCLEVBQUE7O0FBRXpCO0VBQ0ksZUFBZTtFQUNmLGtCQUFrQjtFQUNsQixTQUFTO0VBQ1QsV0FBVztFQUNYLFVBQVU7RUFDVixXQUFXO0VBQ1gsbUJBQW1CO0VBQ25CLFVBQVUsRUFBQTs7QUFFZDtFQUNJLHVCQUF1QjtFQUN2QixtQkFBbUI7RUFDbkIsa0JBQWtCO0VBQ2xCLGdCQUFnQixFQUFBOztBQUVwQjtFQUNJLFdBQVc7RUFDWCxZQUFZO0VBQ1osaUJBQWlCO0VBQ2pCLG1CQUFtQixFQUFBOztBQUd2QjtFQUNJLFlBQVksRUFBQTs7QUFHaEI7RUFDSSxVQUFVLEVBQUEiLCJmaWxlIjoic3JjL2FwcC9fcGFnZXMvbWVzc2FnZXMvbWVzc2FnZXMucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLm5vdFJlYWRNZXNzYWdle1xuICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgIGNvbG9yOiAjOTk5O1xufVxuXG5cbi51c2VyLW1lc3NhZ2UtaW1ne1xuICAgIGJhY2tncm91bmQ6ICNmZmYgO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIHRyYW5zaXRpb246IG9wYWNpdHkgbGluZWFyIDAuM3M7XG4gICAgaGVpZ2h0OiA0NXB4O1xuICAgIHdpZHRoOiA0NXB4O1xuICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XG4gICAgYmFja2dyb3VuZC1zaXplOiAxMDAlO1xufVxuLm5vdC1yZWFkLWNoZWNrZXJ7XG4gICAgYmFja2dyb3VuZDogcmVkO1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6IDE1cHg7XG4gICAgcmlnaHQ6IDEwcHg7XG4gICAgd2lkdGg6IDVweDtcbiAgICBoZWlnaHQ6IDVweDtcbiAgICBib3JkZXItcmFkaXVzOiAxMDAlO1xuICAgIHBhZGRpbmc6IDA7XG59XG4uY2hhdC1uYW1lPmgze1xuICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gICAgbWFyZ2luLXJpZ2h0OiA1MHB4O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG59XG4udXNlci1pbWd7XG4gICAgd2lkdGg6IDQwcHg7XG4gICAgaGVpZ2h0OiA0MHB4O1xuICAgIG1hcmdpbi1yaWdodDogOHB4O1xuICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XG59XG5cbi51c2VyLW1lc3NhZ2UtaW1nLWhpZGV7XG4gICAgb3BhY2l0eTogMC4zO1xufVxuXG4udXNlci1tZXNzYWdlLWltZy1zaG93IHtcbiAgICBvcGFjaXR5OiAxO1xuXG59Il19 */\"","  import { Component, OnInit, NgZone, OnChanges, AfterViewChecked, SimpleChanges } from '@angular/core';\nimport { Chat, ChatMapper } from 'src/app/_models/chat';\nimport { Router, NavigationStart } from '@angular/router';\nimport { ChatService } from 'src/app/_services/chat.service';\nimport { User } from 'src/app/_models/user';\nimport { AuthService } from 'src/app/_services/auth.service';\nimport { Subscription } from 'rxjs';\nimport { Platform, LoadingController } from '@ionic/angular';\nimport { filter, finalize } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-messages',\n  templateUrl: './messages.page.html',\n  styleUrls: ['./messages.page.scss'],\n})\nexport class MessagesPage implements OnInit{\n  private chatSubscription : Subscription\n  chats : Chat[]\n  user: User\n  constructor(\n    private router : Router,\n    private authService : AuthService,\n    private loadCtrl: LoadingController,\n    private chatService : ChatService,\n    private zone: NgZone,\n  ) { \n    this.chatService.notificationCount.next(0)\n    this.authService.currentUser.subscribe(user=>{\n        this.user = user\n    })\n  }\n\n  \n  ngOnInit(){\n    this.router.events.pipe(\n      filter(event =>event instanceof NavigationStart && event.url === '/tabs/messages')\n    ).subscribe((route) =>this.getChats());\n\n    this.chatService.updateChatSubject.subscribe((e)=>this.getChats())\n  }\n  ionViewWillLeave(){\n\n  }\n  getChats(){\n    this.chats = null\n    if(this.chatSubscription != null) this.chatSubscription.unsubscribe()\n    this.chatSubscription = this.chatService.getChats().subscribe(response=>{\n      this.zone.run(()=> this.chats = ChatMapper.fromJsonArray(response['chats']))\n    })\n  }\n  async goToChat(chat:Chat){\n    if(chat.enabled){\n      this.chatService.setActiveChat(chat)\n      this.router.navigate(['/chat', chat.id])\n    }else{\n      let image = document.getElementById('chat-img-'+chat.id)\n      let loader = await this.loadCtrl.create()\n      loader.present()\n      this.chatService.unlock(chat)\n      .pipe(finalize(()=> loader.dismiss()))\n      .subscribe(_chat=>{\n        if (image != null) {\n          image.classList.remove('user-message-img-show')\n          image.classList.add('user-message-img-hide')\n        }\n\n        chat.img = _chat.img\n        chat.enabled = _chat.enabled\n\n        setTimeout(()=>{\n          if (image != null) {\n            image.classList.add('user-message-img-show')\n            image.classList.remove('user-message-img-hide')\n          }\n          this.chatService.setActiveChat(chat)\n          this.router.navigate(['/chat', chat.id])\n        }, 1000)\n      })\n    }\n\n  }\n  viewProfile(id){\n    this.router.navigate(['view-profile',id])\n  }\n  loadImg($event){\n    this.zone.run(()=>{\n      \n    })\n  }\n\n\n  ngOnDestroy() {\n    // always unsubscribe your subscriptions to prevent leaks\n    this.chatSubscription.unsubscribe();\n  }\n}\n"],"sourceRoot":"webpack:///"}