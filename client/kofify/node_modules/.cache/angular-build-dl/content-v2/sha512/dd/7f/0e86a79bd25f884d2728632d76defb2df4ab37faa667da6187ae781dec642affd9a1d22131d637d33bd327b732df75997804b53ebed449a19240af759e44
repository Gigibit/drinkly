{"version":3,"sources":["src/app/_pages/messages/messages.page.html","src/app/_pages/messages/messages.module.ts","src/app/_pages/messages/messages.page.scss","src/app/_pages/messages/messages.page.ts"],"names":[],"mappings":"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","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>messages</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-padding\\\">\\n    <div *ngIf=\\\"chats && chats.length == 0\\\">\\n        <ion-label padding>{{'no_messages' | translate }}</ion-label>\\n    </div>\\n    <ion-list *ngIf=\\\"!chats\\\">\\n        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>\\n        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>        <ion-item>\\n          <ion-avatar class=\\\"user-message-img\\\" slot=\\\"start\\\">\\n            <ion-skeleton-text></ion-skeleton-text>\\n          </ion-avatar>\\n          <ion-label>\\n            <ion-skeleton-text animated style=\\\"width: 70%; height: 17px;\\\"></ion-skeleton-text>\\n            <ion-skeleton-text animated style=\\\"width: 40%;\\\"></ion-skeleton-text>\\n          </ion-label>\\n        </ion-item>\\n      </ion-list>\\n    <ion-list *ngIf=\\\"chats && chats.length > 0\\\">\\n        <ion-item *ngFor=\\\"let chat of chats\\\" (click)=\\\"goToChat(chat, $event)\\\">\\n          <ion-avatar id=\\\"chat-img-{{chat.id}}\\\" class=\\\"user-message-img user-message-img-show\\\" slot=\\\"start\\\">\\n            <img \\n            class=\\\"user-img\\\"\\n            (load)=\\\"loadImg($event)\\\"\\n            (click)=\\\"$event.stopPropagation(); viewProfile(chat.users[0].user.id)\\\"\\n            onError=\\\"this.src='../../assets/imgs/user.svg';\\\"             \\n            src=\\\"{{chat.img}}\\\" />\\n          </ion-avatar>\\n          <ion-label class=\\\"chat-name\\\">\\n            <h3>{{chat.name}}</h3>\\n            <p *ngIf=\\\"chat.lastMessage\\\" [class.notReadMessage]=\\\"chat.lastMessage.readBy.indexOf(user?.id) == -1\\\">{{chat.lastMessage.content}}</p>\\n          </ion-label>\\n          <div class=\\\"not-read-checker\\\" *ngIf=\\\"chat.lastMessage.readBy.indexOf(user?.id) == -1\\\"></div>\\n        </ion-item>\\n      </ion-list>\\n\\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MessagesPage } from './messages.page';\nimport { TranslateModule } from '@ngx-translate/core';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MessagesPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    TranslateModule.forChild(),\n    RouterModule.forChild(routes)\n  ],\n  declarations: [MessagesPage]\n})\nexport class MessagesPageModule {}\n","export default \".notReadMessage {\\n  font-weight: bold;\\n  color: #999; }\\n\\n.user-message-img {\\n  background: #fff;\\n  display: block;\\n  -webkit-transition: all linear 0.3s;\\n  transition: all linear 0.3s;\\n  height: 45px;\\n  width: 45px; }\\n\\n.not-read-checker {\\n  background: red;\\n  position: absolute;\\n  top: 15px;\\n  right: 10px;\\n  width: 5px;\\n  height: 5px;\\n  border-radius: 100%;\\n  padding: 0; }\\n\\n.chat-name > h3 {\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  margin-right: 50px;\\n  overflow: hidden; }\\n\\n.user-message-img-hide {\\n  opacity: 0; }\\n\\n.user-message-img-show {\\n  opacity: 1; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9sdWlnaWNob3VncmFkL2FyY2hpbWVkaWEvcHJvamVjdHMva29raWZ5L2ljZWJyZWFrZXIvY2xpZW50L2tvZmlmeS9rb2ZpZnkvc3JjL2FwcC9fcGFnZXMvbWVzc2FnZXMvbWVzc2FnZXMucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksaUJBQWlCO0VBQ2pCLFdBQVcsRUFBQTs7QUFJZjtFQUNJLGdCQUFpQjtFQUNqQixjQUFjO0VBQ2QsbUNBQTJCO0VBQTNCLDJCQUEyQjtFQUMzQixZQUFZO0VBQ1osV0FBVyxFQUFBOztBQUVmO0VBQ0ksZUFBZTtFQUNmLGtCQUFrQjtFQUNsQixTQUFTO0VBQ1QsV0FBVztFQUNYLFVBQVU7RUFDVixXQUFXO0VBQ1gsbUJBQW1CO0VBQ25CLFVBQVUsRUFBQTs7QUFFZDtFQUNJLHVCQUF1QjtFQUN2QixtQkFBbUI7RUFDbkIsa0JBQWtCO0VBQ2xCLGdCQUFnQixFQUFBOztBQUlwQjtFQUNJLFVBQVUsRUFBQTs7QUFHZDtFQUNJLFVBQVUsRUFBQSIsImZpbGUiOiJzcmMvYXBwL19wYWdlcy9tZXNzYWdlcy9tZXNzYWdlcy5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIubm90UmVhZE1lc3NhZ2V7XG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgY29sb3I6ICM5OTk7XG59XG5cblxuLnVzZXItbWVzc2FnZS1pbWd7XG4gICAgYmFja2dyb3VuZDogI2ZmZiA7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgdHJhbnNpdGlvbjogYWxsIGxpbmVhciAwLjNzO1xuICAgIGhlaWdodDogNDVweDtcbiAgICB3aWR0aDogNDVweDtcbn1cbi5ub3QtcmVhZC1jaGVja2Vye1xuICAgIGJhY2tncm91bmQ6IHJlZDtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAxNXB4O1xuICAgIHJpZ2h0OiAxMHB4O1xuICAgIHdpZHRoOiA1cHg7XG4gICAgaGVpZ2h0OiA1cHg7XG4gICAgYm9yZGVyLXJhZGl1czogMTAwJTtcbiAgICBwYWRkaW5nOiAwO1xufVxuLmNoYXQtbmFtZT5oM3tcbiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbiAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICAgIG1hcmdpbi1yaWdodDogNTBweDtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xufVxuXG5cbi51c2VyLW1lc3NhZ2UtaW1nLWhpZGV7XG4gICAgb3BhY2l0eTogMDtcbn1cblxuLnVzZXItbWVzc2FnZS1pbWctc2hvdyB7XG4gICAgb3BhY2l0eTogMTtcblxufSJdfQ== */\"","  import { Component, OnInit, NgZone, OnChanges, AfterViewChecked, SimpleChanges } from '@angular/core';\nimport { Chat, ChatMapper } from 'src/app/_models/chat';\nimport { Router, NavigationStart } from '@angular/router';\nimport { ChatService } from 'src/app/_services/chat.service';\nimport { User } from 'src/app/_models/user';\nimport { AuthService } from 'src/app/_services/auth.service';\nimport { Subscription } from 'rxjs';\nimport { Platform, LoadingController } from '@ionic/angular';\nimport { filter, finalize } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-messages',\n  templateUrl: './messages.page.html',\n  styleUrls: ['./messages.page.scss'],\n})\nexport class MessagesPage implements OnInit{\n  private chatSubscription : Subscription\n  chats : Chat[]\n  user: User\n  constructor(\n    private router : Router,\n    private authService : AuthService,\n    private loadCtrl: LoadingController,\n    private chatService : ChatService,\n    private zone: NgZone,\n  ) { \n    this.chatService.notificationCount.next(0)\n    this.authService.currentUser.subscribe(user=>{\n        this.user = user\n    })\n  }\n\n  \n  ngOnInit(){\n    this.router.events.pipe(\n      filter(event =>event instanceof NavigationStart && event.url.indexOf('tabs/messages') != -1)\n    ).subscribe((route) =>this.getChats());\n\n    this.chatService.updateChatSubject.subscribe((e)=>this.getChats())\n  }\n  ionViewWillLeave(){\n\n  }\n  getChats(){\n    if(this.chatSubscription != null) this.chatSubscription.unsubscribe()\n    this.chatSubscription = this.chatService.getChats().subscribe(response=>{\n      this.zone.run(()=> this.chats = ChatMapper.fromJsonArray(response['chats']))\n    })\n  }\n  async goToChat(chat:Chat){\n    if(chat.enabled){\n      this.chatService.setActiveChat(chat)\n      this.router.navigate(['/chat', chat.id])\n    }else{\n      let image = document.getElementById('chat-img-'+chat.id)\n      let loader = await this.loadCtrl.create()\n      loader.present()\n      this.chatService.unlock(chat)\n      .pipe(finalize(()=> loader.dismiss()))\n      .subscribe(_chat=>{\n        image.classList.remove('user-message-img-show')\n        image.classList.add('user-message-img-hide')\n        chat.img = _chat.img\n        chat.enabled = _chat.enabled\n\n        setTimeout(()=>{\n          image.classList.add('user-message-img-show')\n          image.classList.remove('user-message-img-hide')\n          this.chatService.setActiveChat(chat)\n          this.router.navigate(['/chat', chat.id])\n        }, 1000)\n      })\n    }\n\n  }\n  viewProfile(id){\n    this.router.navigate(['view-profile',id])\n  }\n  loadImg($event){\n    // this.zone.run(()=>{\n    //   $event.target.classList.remove('imgInLoading')\n    //   $event.target.classList.add('imgLoaded')\n    // })\n  }\n\n\n  ngOnDestroy() {\n    // always unsubscribe your subscriptions to prevent leaks\n    this.chatSubscription.unsubscribe();\n  }\n}\n"],"sourceRoot":"webpack:///","file":"_pages-messages-messages-module-es5.js"}